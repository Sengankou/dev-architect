# チャットUI マニュアルテストチェックリスト

**Feature**: Phase 2 User Story 4 - 簡易チャットUI  
**Test Type**: Manual UI Testing  
**Created**: 2025-10-25

---

## 前提条件

- [ ] 開発サーバーが起動している (`pnpm run dev`)
- [ ] ブラウザで http://localhost:8787 にアクセス可能
- [ ] `.env`ファイルに`GOOGLE_GENERATIVE_AI_API_KEY`が設定されている

---

## TC-UI-001: 初回アクセス時の表示

**手順**:
1. ブラウザで http://localhost:8787 にアクセス
2. ページの初期状態を確認

**期待される結果**:
- [ ] ページタイトルが「Dev Architect - 要件定義支援」と表示される
- [ ] メッセージ入力欄（textarea）が表示される
- [ ] 送信ボタンが表示され、有効状態である
- [ ] チャットメッセージ表示エリアが空である
- [ ] レイアウトが崩れていない
- [ ] スマートフォン表示でも正常に表示される（レスポンシブ）

---

## TC-UI-002: 初回メッセージ送信（新規セッション作成）

**手順**:
1. メッセージ入力欄に「ECサイトのカート機能を実装したいです」と入力
2. 送信ボタンをクリック

**期待される結果**:
- [ ] 送信ボタンが無効化される（ローディング中）
- [ ] ユーザーメッセージが即座に画面に表示される
- [ ] ユーザーメッセージに「user」スタイルが適用される
- [ ] 数秒後、AI応答が画面に表示される
- [ ] AI応答に「assistant」スタイルが適用される
- [ ] AI応答が日本語で意味のある内容である
- [ ] 送信後、入力欄が空になる
- [ ] 送信ボタンが再び有効化される
- [ ] localStorage に sessionId が保存される
- [ ] XSS攻撃が防止されている（textContent使用、innerHTML不使用）

---

## TC-UI-003: 既存セッション継続（会話コンテキスト保持）

**前提**: TC-UI-002が完了している

**手順**:
1. メッセージ入力欄に「はい、在庫管理も必要です」と入力
2. 送信ボタンをクリック

**期待される結果**:
- [ ] 送信ボタンが無効化される
- [ ] 新しいユーザーメッセージが画面に追加表示される
- [ ] AI応答が前回の会話を踏まえた内容（「カート機能」「在庫管理」に言及）
- [ ] メッセージが時系列順（古い順）で表示される
- [ ] 入力欄が空になり、送信ボタンが再有効化される
- [ ] sessionId が変更されていない（localStorage確認）

---

## TC-UI-004: ページリロード時の会話履歴復元

**前提**: TC-UI-003が完了している

**手順**:
1. ブラウザをリロード（F5 または Cmd+R）
2. ページが再読み込みされる

**期待される結果**:
- [ ] ページロード時、localStorage から sessionId が読み込まれる
- [ ] GET /api/chat/:sessionId/history が自動的に呼ばれる
- [ ] 過去の会話履歴（4件のメッセージ）が画面に復元される
- [ ] メッセージが時系列順（古い順）で表示される
- [ ] user/assistant スタイルが正しく適用される
- [ ] 入力欄は空で、送信ボタンは有効状態

---

## TC-UI-005: 空メッセージ送信の防止

**手順**:
1. メッセージ入力欄を空のままにする
2. 送信ボタンをクリック

**期待される結果**:
- [ ] APIリクエストが送信されない
- [ ] 送信ボタンが無効化されない
- [ ] または、クライアント側でバリデーションエラーメッセージが表示される

---

## TC-UI-006: エラーハンドリング（400エラー）

**手順**:
1. 開発者ツールのNetworkタブを開く
2. メッセージ入力欄に空文字列を無理やり送信（JavaScriptコンソールから）
   ```javascript
   fetch('/api/chat', {
     method: 'POST',
     headers: {'Content-Type': 'application/json'},
     body: JSON.stringify({message: ''})
   })
   ```

**期待される結果**:
- [ ] ユーザーフレンドリーなエラーメッセージが画面に表示される
- [ ] エラーメッセージの内容が日本語
- [ ] エラーメッセージに「メッセージは1文字以上である必要があります」などの具体的な説明
- [ ] 送信ボタンが再有効化される

---

## TC-UI-007: エラーハンドリング（503エラー）

**前提**: AI APIキーが無効またはネットワークエラー

**手順**:
1. `.env`ファイルの`GOOGLE_GENERATIVE_AI_API_KEY`を無効な値に変更
2. サーバーを再起動
3. メッセージを送信

**期待される結果**:
- [ ] ユーザーフレンドリーなエラーメッセージが画面に表示される
- [ ] エラーメッセージ例: 「AI応答の生成に失敗しました。しばらく待ってから再試行してください。」
- [ ] 送信ボタンが再有効化される
- [ ] ユーザーメッセージは画面に表示されたまま
- [ ] エラー後も再送信が可能

---

## TC-UI-008: 長いメッセージの表示

**手順**:
1. 500文字以上の長いメッセージを入力
2. 送信ボタンをクリック

**期待される結果**:
- [ ] 長いメッセージが画面に正しく表示される
- [ ] レイアウトが崩れない
- [ ] テキストが折り返され、横スクロールが発生しない
- [ ] AI応答も長い場合、同様に正しく表示される

---

## TC-UI-009: レスポンシブデザイン（スマートフォン）

**手順**:
1. ブラウザのデベロッパーツールで「デバイスモード」を有効化
2. iPhone 12 または Galaxy S20 のビューポートに切り替え
3. TC-UI-002とTC-UI-003を再実行

**期待される結果**:
- [ ] レイアウトが崩れない
- [ ] メッセージ入力欄と送信ボタンが使いやすいサイズ
- [ ] チャット履歴が縦スクロール可能
- [ ] タップ操作が問題なく動作
- [ ] フォントサイズが読みやすい

---

## TC-UI-010: 複数セッション管理

**手順**:
1. 既存のセッションで会話を行う
2. ブラウザの localStorage をクリア（開発者ツール > Application > Local Storage）
3. ページをリロード
4. 新しいメッセージを送信

**期待される結果**:
- [ ] 新しい sessionId が生成される
- [ ] 過去の会話履歴は表示されない（新規セッション）
- [ ] 新しいセッションで正常に会話が開始できる
- [ ] 新しい sessionId が localStorage に保存される

---

## TC-UI-011: XSSセキュリティ

**手順**:
1. メッセージ入力欄に以下を入力:
   ```html
   <script>alert('XSS')</script>
   ```
2. 送信ボタンをクリック

**期待される結果**:
- [ ] アラートが表示されない（スクリプトが実行されない）
- [ ] メッセージがプレーンテキストとして表示される
- [ ] `<script>` タグがそのまま表示される（エスケープされている）
- [ ] FR-018（XSS対策）が正しく実装されている

---

## TC-UI-012: パフォーマンス（SC-009）

**手順**:
1. ブラウザのパフォーマンスタブまたはLighthouseを使用
2. ページロード時間とUIレスポンスを計測

**期待される結果**:
- [ ] 初回ページロード: 3秒以内（SC-001相当）
- [ ] メッセージ送信からAI応答表示: 6秒以内（SC-009）
- [ ] ページリロード時の履歴復元: 2秒以内

---

## 合格基準

以下すべてが✅であれば、User Story 4は合格:

- [ ] TC-UI-001: 初回表示
- [ ] TC-UI-002: 新規セッション作成
- [ ] TC-UI-003: 会話継続
- [ ] TC-UI-004: 履歴復元
- [ ] TC-UI-005: 空メッセージ防止
- [ ] TC-UI-006: 400エラー処理
- [ ] TC-UI-007: 503エラー処理
- [ ] TC-UI-008: 長いメッセージ
- [ ] TC-UI-009: レスポンシブ
- [ ] TC-UI-010: 複数セッション
- [ ] TC-UI-011: XSS対策
- [ ] TC-UI-012: パフォーマンス

---

## 注意事項

- このチェックリストは手動テストです
- 各テストケースを順番に実行してください
- 問題が発生した場合は、開発者ツールのConsoleとNetworkタブを確認
- Phase 3以降でPlaywright/Puppeteerによる自動E2Eテストを検討
